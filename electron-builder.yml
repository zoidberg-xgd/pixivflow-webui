appId: com.pixivflow.webui
productName: PixivFlow
copyright: Copyright © 2024
executableName: PixivFlow

publish: null

# 加速构建
electronDownload:
  cache: ~/.electron-cache

directories:
  buildResources: build
  output: release

# files 配置：打包所有必要的文件
# electron-builder 会自动包含 package.json 中 dependencies 的所有依赖
files:
  - "package.json"
  - "electron/**/*"
  - "dist/**/*"
  - "!electron/**/*.{ts,map}"
  - "!dist/**/*.map"
  - "!src/**/*"
  - "!**/.git/**/*"
  - "!**/.DS_Store"
  # 包含所有 node_modules（electron-builder 会自动排除 devDependencies）
  # 这样可以确保所有运行时依赖都被包含，避免遗漏
  - "node_modules/**/*"
  # 排除一些不需要的文件以减小体积
  - "!**/node_modules/**/*.md"
  - "!**/node_modules/**/*.txt"
  - "!**/node_modules/**/*.map"
  - "!**/node_modules/**/test/**/*"
  - "!**/node_modules/**/tests/**/*"
  - "!**/node_modules/**/__tests__/**/*"
  - "!**/node_modules/**/*.test.js"
  - "!**/node_modules/**/*.spec.js"
  - "!**/node_modules/**/examples/**/*"
  - "!**/node_modules/**/example/**/*"

asar: true

# 将 pixivflow 后端复制到应用资源目录
# 这样可以避免在 afterPack 中重新安装，大幅加速构建
# 注意：extraResources 会将文件复制到 app.asar.unpacked 或 Resources 目录
extraResources:
  - from: "node_modules/pixivflow"
    to: "pixivflow"
    filter:
      - "**/*"
  # 复制 pixivflow 的 node_modules（后端依赖）
  - from: "node_modules/pixivflow/node_modules"
    to: "pixivflow/node_modules"
    filter:
      - "**/*"
  # 复制前端 dist 文件到 extraResources，方便后端直接访问
  - from: "dist"
    to: "webui-dist"
    filter:
      - "**/*"

# 构建优化
compression: normal  # 使用普通压缩（更快），可选: store, normal, maximum
removePackageScripts: true  # 移除 package.json 中的脚本以减小体积

# electron-builder 标准钩子：打包后重命名应用
# 这是 electron-builder 的官方功能，不是自定义脚本
afterPack: build/afterPack.cjs

mac:
  target:
    - target: dir  # 只生成目录，不打包 DMG（最快）
      arch:
        - arm64
  icon: build/icon.icns
  category: public.app-category.utilities
  hardenedRuntime: false
  gatekeeperAssess: false
  artifactName: "${productName}-${version}-${arch}.${ext}"
  # 通过 extendInfo 设置应用名称（CFBundleName）
  extendInfo:
    CFBundleName: PixivFlow
    CFBundleDisplayName: PixivFlow
